<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBC</title>

    <!--Bootrap-5.3.0-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

    <!--JQuery-3.6.4-->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    
    <!--JQuery-csv-1.0.21-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js" integrity="sha512-Y8iWYJDo6HiTo5xtml1g4QqHtl/PO1w+dmUpQfQSOTqKNsMhExfyPN2ncNAe9JuJUSKzwK/b6oaNPop4MXzkwg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="js/data-generation.js"></script>
    <script src="js/naive-bayes-classifier.js"></script>
    <script src="js/confusion-matrix.js"></script>

    <link href="css/main.css" rel="stylesheet">
    <link href="css/header-small.css" rel="stylesheet">
    <link href="css/section.css" rel="stylesheet">

</head>
<body>
    <header class="row">
        <div class="col-1 col-lg-2"></div>
        <div class="col-10 col-lg-8 d-flex flex-column align-items-start justify-content-center">
            <h1>Naive Bayes Classifier</h1>
            <h2>Description of project</h2>
        </div>
        <div class="col-1 col-lg-2"></div>
    </header>

    <section class="row">
        <div class="hidden col-md-1 col-lg-2 col-xxl-3"></div>
        <div class="col-12 col-md-10 col-lg-8 col-xxl-6">
            <h1>Project explanation</h1>
            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ut tellus auctor, finibus velit eu, bibendum nunc. 
            </p>
            <p>
                Duis vel felis sit amet magna tempor consequat. Ut eget magna vitae mauris semper pharetra ac eu sapien. Integer pulvinar ligula ut arcu ultrices, in blandit massa vestibulum.
            </p>
        </div>
        <div class="hidden col-md-1 col-lg-2 col-xxl-3"></div>
    </section>

    <section class="row">
        <div class="hidden col-md-1 col-lg-2 col-xxl-3"></div>
        <div class="col-12 col-md-10 col-lg-8 col-xxl-6">
            <h1>Result metrics and data</h1>
            <ul class="nav nav-tabs">
                <li class="nav-item">
                  <a class="nav-link active" id="show-metrics">Metrics</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="show-data">Data</a>
              </ul>
              <div id="metrics-wrapper"></div>    
              <div id="data-wrapper"></div>      
        </div>
        <div class="hidden col-md-1 col-lg-2 col-xxl-3"></div>
    </section>

    <section class="row">
        <div class="hidden col-md-1 col-lg-2 col-xxl-3"></div>
        <div class="col-12 col-md-10 col-lg-8 col-xxl-6">
            <h1>Training configuration</h1>
            <div class="input-group mb-3">
                <span class="input-group-text">Split training/testing</span>
                <input type="number" class="form-control" id="train-split" value="0.7" min="0" max="1">
            </div>
            <div class="input-group mb-3">
                <button type="button" class="btn btn-primary" id="test">Test model</button>
            </div>
        </div>
    </section>

    <script>

        async function testModel(){
            const data = shuffle(await loadCSV('https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv'));
            
            const [trainData, testData] = split(data, 0.7);

            const trainPredictors = trainData.map(row => [row.Embarked, row.Pclass, row.Sex]);
            const trainClass = trainData.map(row => row.Survived == 0 ? 'NoSurv' : 'Surv');
            
            const testPredictors = testData.map(row => [row.Embarked, row.Pclass, row.Sex]);
            const testClass = testData.map(row => row.Survived == 0 ? 'NoSurv' : 'Surv');
    
            const classifier = new NBC(trainPredictors, trainClass);
                            
            let predicted = [];

            for(let recordIndex = 0; recordIndex < testPredictors.length; recordIndex++)
                predicted.push(classifier.classify(testPredictors[recordIndex]).class);

            let cmat = new ConfusionMatrix(testClass, predicted);
            console.log(cmat.labels);
            console.log(cmat.matrix);
            console.log(cmat.precision);
            console.log(cmat.recall);
            console.log(cmat.f1score);
            
            return cmat;
        }

        (async () => {
            await testModel();
        })();
    </script>
</body>
</html>